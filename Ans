getDetailSync.py
-rwxr-xr-x  1 root    root      2327 Jul  5  2025 getIIBAlerts.py
-rwxr-xr-x  1 root    root      2490 Jul 23  2025 getMQAlerts.py
-rwxrwxrwx  1 root    root      1261 Aug 21 15:44 ldabCert.cer
-rwxr-x---  1 root    root      1261 Nov  5 17:13 ldabCert.crt
-rw-r-----  1 root    root       686 Nov  5 17:13 ldabLogin.py
-rwxr-xr-x  1 eisuser eisuser   1375 Nov 22  2024 manage.py
drwxr-xr-x  2 eisuser eisuser   4096 Dec 27  2024 media
-rwxr-xr-x  1 eisuser eisuser   3845 Dec  8 13:16 models.py
-rwxr-xr-x  1 root    root      4155 Jul  3  2025 mq_data_insert.py
drwxr-xr-x  3 eisuser eisuser     18 May 23  2025 mq_logs
drwxr-x---  4 root    root      4096 Jan 29 15:36 prDrSync
-rwxr-xr-x  1 root    root      1481 May 27  2025 prdr.py
drwxr-xr-x  5 eisuser eisuser     54 Sep 19  2024 productionfiles
-rwxr-xr-x  1 eisuser eisuser   1863 Dec 19 21:00 saveBrokerEgApi.py
-rwxr-xr-x  1 eisuser eisuser   1602 Dec 17 21:00 saveLayerBrEgApi.py
drwxr-xr-x  7 root    root        87 Oct 14 12:50 static
drwxrwxr-x  3 eisuser eisuser     20 Feb  9 16:29 staticfiles
-rw-r-----  1 root    root      1403 Jan 12 19:00 task.txt
-rwxr-xr-x  1 root    root      4530 Jun 24  2025 testanalysis.py
drwxr-x---  2 root    root        79 Nov 20 13:12 viewsBackup
-rwxr-xr-x  1 eisuser eisuser   4163 Dec  5 15:18 volume_analysis.py
-rwxr-xr-x  1 root    root      5224 Sep 25 11:44 volume_analysislive.py
-rwxr-xr-x  1 root    root      4094 Jun 11  2025 volume_analysislive.py_cp
[root@eispr-prt1-01 PyPortal]# vi getDetailSync.py
[root@eispr-prt1-01 PyPortal]# python getDetailSync.py
Traceback (most recent call last):
  File "/var/www/cgi-bin/PyPortal/getDetailSync.py", line 2, in <module>
    import django
ModuleNotFoundError: No module named 'django'
[root@eispr-prt1-01 PyPortal]#  /var/www/cgi-bin/djangovenv/venv/bin/python3.9 getDetailSync.py
{'brokerStatus': True, 'udpPort': 4415, 'egs': {'NP_S_01': {'egName': 'NP_S_01', 'egStatus': True}}}
v1012665
@Rocky056
https://10.188.25.163:4415/apiv2/servers/NP_S_01/rest-apis?depth=5
/var/www/cgi-bin/djangovenv/venv/lib64/python3.9/site-packages/urllib3/connectionpool.py:1097: InsecureRequestWarning: Unverified HTTPS request is being made to host '10.188.25.163'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#tls-warnings
  warnings.warn(
{"type":"responseLog","uri":"","count":1,"LogEntry":[{"type":"logEntry","message":{"source":"BIPmsgs","timestamp":1770639273236,"threadId":0,"threadSequenceNumber":1,"number":8509,"severityCode":"E","severity":20,"inserts":1},"detailedText":"Administration security is enabled. A valid user name and password must be provided. \nRetry with the correct user name and password. If you are still unable to log in, contact your IBM App Connect Enterprise administrator, who can reset the password by using the mqsiwebuseradmin command. If too many unsuccessful login attempts are made, your account will be locked for 300 seconds. ","text":"BIP8509E: Invalid user name or password. "}]}
None
[root@eispr-prt1-01 PyPortal]# cat getDetailSync.py
import os
import django




os.environ.setdefault('DJANGO_SETTINGS_MODULE','PyPortal.settings')
django.setup()


from django.shortcuts import render
#from django.core import serializers
from django.http import HttpResponse,JsonResponse
from dbOpTest.models import BrokerDetails,EGDetails,ServiceDetails,ServerDetails,LayerDetails
from django.views.decorators.csrf import csrf_exempt
import requests
from requests.auth import HTTPBasicAuth

def getDataUDP(serverIp,udpPort,egName):
    username=os.environ.get('UDP_USERNAME')
    password=os.environ.get('UDP_PASSWORD')
    print(username)
    print(password)
    session=requests.Session()
    urlTemplate='https://{serverIp}:{udpPort}/apiv2/servers/{egName}/rest-apis?depth=5'
    #urlTemplate='https://{serverIp}:{udpPort}/apiv2/servers/'
    session.auth = HTTPBasicAuth(username,password)
    session.headers.update = {
            "Accept": "application/json",
            "Content-Type": "application/json"
            }
    session.verify = False
    currEgDataUrl=urlTemplate.format(serverIp=serverIp,udpPort=udpPort,egName=egName)
    print(currEgDataUrl)
    data = session.get(currEgDataUrl)
    print(data.text)

'''
server = ServerDetails.objects.prefetch_related("BrokerDetails_entries","BrokerDetails_entries__EGDetails_entries").all()
print(len(server))
egSize=0
serverEgMap=dict()
for ser in server:
    br_map={}
    print(ser.serverIP)
    serverIp=ser.serverIP
    if ser.serverIP.startswith("yp"):
        continue
    for broker in ser.BrokerDetails_entries.all():
         print("hosl")
         ''if broker.brokerName in br_map:
             continue''
         br_map[broker.brokerName]="exist"
         egDetailss=list()
         eg_map={}
         exg=0
         uniqueEg=0
         for eg in broker.EGDetails_entries.all():
             if exg == 0:
                serDetails=list()
                ser=0
                if eg.egName in eg_map:
                   uniqueEg=1
                   continue
                eg_map[eg.egName]="exist"
                egDetailss.append({"egName":eg.egName,"egStatus":eg.egStatus})
                exg+=1
         if uniqueEg == 0:
            if str(serverIp) in serverEgMap:
                serverEgMap[serverIp]+=1
            else:
                serverEgMap[serverIp]=1
            egSize+=1
            print({"udpPort":broker.udpPort,"brokerName":broker.brokerName,"brokerStatus":broker.brokerStatus,"egDetails":egDetailss})
print(egSize)
print(serverEgMap)
#getDataUDP("10.188.25.190",4419,"PAN_EXP_01")
'''

egs = (
        EGDetails.objects
        .select_related(
            "broker",
            "broker__server",
            "broker__server__layer",
            )
        )

egSize=0
serEg=dict()

'''
for eg in egs:
    if eg.broker.server.serverIP.startswith("yp"):
        continue
    if eg.broker.server.serverIP in serEg:
        if eg.broker.brokerName in serEg[eg.broker.server.serverIP]:
           if eg.egName not in
           serEg[eg.broker.server.serverIP][eg.broker.brokerName].append(eg.egName)

        else:
           serEg[eg.broker.server.serverIP][eg.broker.brokerName]=1
    else:
       serEg[eg.broker.server.serverIP]={}
       serEg[eg.broker.server.serverIP][eg.broker.brokerName]=1
    print(eg.broker.server.serverIP)
    print(eg.egName)
    print(eg.broker.brokerName)
    egSize+=1
'''

for eg in egs:
    serverIP = eg.broker.server.serverIP

    if serverIP.startswith("yp"):
        continue

    brokerName = eg.broker.brokerName
    egName = eg.egName

    if serverIP not in serEg:
        serEg[serverIP] = {}


    if brokerName not in serEg[serverIP]:
        serEg[serverIP][brokerName] = {
                "brokerStatus" : eg.broker.brokerStatus,
                "udpPort" : eg.broker.udpPort,
                "egs": {}
                }
    if egName not in serEg[serverIP][brokerName]["egs"]:
        serEg[serverIP][brokerName]["egs"][egName] = {
                 "egName": eg.egName,
                 "egStatus": eg.egStatus
                 }
        egSize+=1





#print(egSize)
print(serEg["25_163"]["NP_SYS"])

print(getDataUDP("10.188.25.163",serEg["25_163"]["NP_SYS"]["udpPort"],serEg["25_163"]["NP_SYS"]['egs']['NP_S_01']['egName']))
