// src/App.js
import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import Header from './components/Header';
import Footer from './components/Footer';
import Home from './components/Home'; // New component
import Login from './components/Login';
import './App.css';

function App() {
  const [auth, setAuth] = useState({
    isLoggedIn: false,
    username: ''
  });

  // Check authentication on app load
  useEffect(() => {
    const storedUsername = localStorage.getItem('username');
    const storedLoginTime = localStorage.getItem('loginTime');
    
    if (storedUsername && storedLoginTime) {
      const loginTime = parseInt(storedLoginTime, 10);
      if (Date.now() - loginTime < 60 * 60 * 1000) { // 1 hour session
        setAuth({
          isLoggedIn: true,
          username: storedUsername
        });
      } else {
        handleLogout();
      }
    }
  }, []);

  const handleLogin = (username) => {
    const now = Date.now();
    setAuth({
      isLoggedIn: true,
      username
    });
    localStorage.setItem('username', username);
    localStorage.setItem('loginTime', now.toString());
  };

  const handleLogout = () => {
    setAuth({
      isLoggedIn: false,
      username: ''
    });
    localStorage.removeItem('username');
    localStorage.removeItem('loginTime');
    sessionStorage.removeItem('redirectUrl');
  };

  return (
    <Router>
      <div className="app">
        <Header
          username={auth.username}
          onLogout={handleLogout}
        />
        
        <Routes>
          <Route path="/login" element={
            auth.isLoggedIn ? (
              <Navigate to="/" replace />
            ) : (
              <Login onLogin={handleLogin} />
            )
          } />
          
          <Route path="/" element={
            auth.isLoggedIn ? (
              <Home auth={auth} />
            ) : (
              <Navigate to="/login" replace />
            )
          } />
        </Routes>
        
        <Footer />
      </div>
    </Router>
  );
}

export default App;


// src/components/Home.js
import React, { useState } from 'react';
import Menu from './Menu';
import Dashboard from './Dashboard';
import Chatbot from './ChatBot';

function Home({ auth }) {
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);
  const [chatbotMinimized, setChatbotMinimized] = useState(false);

  return (
    <>
      <div className={`main ${isSidebarOpen ? "sidebar-open" : "sidebar-collapsed"}`}>
        <Menu
          isSidebarOpen={isSidebarOpen}
          setIsSidebarOpen={setIsSidebarOpen}
          isLoggedIn={auth.isLoggedIn}
        />
        <Dashboard isSidebarOpen={isSidebarOpen} />
        <Chatbot 
          setChatbotMinimized={setChatbotMinimized} 
          username={auth.username} 
        />
      </div>
    </>
  );
}

export default Home;

